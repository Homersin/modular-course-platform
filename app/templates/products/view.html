{% extends 'layout.html' %}

{% block title %}{% if product.meta_title %}{{ product.meta_title }}{% else %}{{ product.title }} - {{ super() }}{% endif %}{% endblock %}

{% block meta %}
    {% if product.meta_description %}
    <meta name="description" content="{{ product.meta_description }}">
    {% endif %}
{% endblock %}

{% block styles %}
<style>
    .product-header {
        background-color: #f8f9fa;
        padding: 2rem 0;
        margin-bottom: 2rem;
    }
    
    .product-img {
        max-width: 100%;
        max-height: 350px;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .product-price {
        font-size: 2rem;
        font-weight: 700;
        color: #4a6cf7;
        margin-bottom: 1rem;
    }
    
    .product-price.free {
        color: #28a745;
    }
    
    .product-description {
        font-size: 1.1rem;
        line-height: 1.6;
        margin-bottom: 2rem;
    }
    
    .badge-purchased {
        background-color: #28a745;
        color: white;
        font-weight: 500;
        font-size: 1rem;
        padding: 0.5rem 1rem;
    }
    
    .action-btn {
        font-size: 1.1rem;
        padding: 0.5rem 1.5rem;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .featured-text {
        font-size: 1.2rem;
        font-weight: 600;
        color: #fd7e14;
        margin-bottom: 1rem;
        padding: 0.5rem;
        border-left: 4px solid #fd7e14;
    }
    
    .benefits-section, .testimonials-section, .faq-section {
        margin-top: 3rem;
        padding-top: 1.5rem;
        border-top: 1px solid #dee2e6;
    }
    
    .benefit-item {
        display: flex;
        margin-bottom: 1.5rem;
    }
    
    .benefit-icon {
        font-size: 1.5rem;
        color: #4a6cf7;
        margin-right: 1rem;
        margin-top: 0.25rem;
    }
    
    .testimonial-card {
        background-color: #f8f9fa;
        border-left: 4px solid #4a6cf7;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: 0.25rem;
    }
    
    .faq-item {
        margin-bottom: 1.5rem;
    }
    
    .faq-question {
        font-weight: 600;
        color: #343a40;
        margin-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="product-header">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('products.index') }}">Products</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>

<div class="container mb-5">
    <div class="row">
        <div class="col-md-5 mb-4">
            {% if product.image_path %}
            <img src="{{ url_for('static', filename=product.image_path) }}" alt="{{ product.title }}" class="product-img">
            {% else %}
            <div class="d-flex justify-content-center align-items-center bg-light" style="height: 350px; border-radius: 8px;">
                <i class="fas fa-box fa-7x text-muted"></i>
            </div>
            {% endif %}
        </div>
        <div class="col-md-7">
            <h1 class="display-5 fw-bold mb-3">{{ product.title }}</h1>
            
            {% if product.featured_text %}
            <div class="featured-text">
                {{ product.featured_text }}
            </div>
            {% endif %}
            
            <div class="product-price {% if product.is_free %}free{% endif %}">
                {% if product.is_free %}
                    Free
                {% else %}
                    ${{ "%.2f"|format(product.price) }}
                {% endif %}
            </div>
            
            {% if is_purchased %}
            <div class="mb-4">
                <span class="badge badge-purchased">
                    <i class="fas fa-check-circle me-1"></i> Purchased
                </span>
            </div>
            {% endif %}
            
            <div class="product-description">
                {{ product.description|safe }}
            </div>
            
            <div class="d-flex flex-wrap">
                {% if is_purchased %}
                    {% if product.has_external_url %}
                    <a href="{{ product.external_url }}" target="_blank" class="btn btn-success action-btn">
                        <i class="fas fa-external-link-alt me-1"></i> Access Product
                    </a>
                    {% else %}
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-primary action-btn">
                        <i class="fas fa-clipboard-list me-1"></i> Go to Dashboard
                    </a>
                    {% endif %}
                {% else %}
                    {% if product.has_external_url %}
                    <a href="{{ product.external_url }}" target="_blank" class="btn btn-outline-primary action-btn">
                        <i class="fas fa-external-link-alt me-1"></i> Visit Website
                    </a>
                    {% else %}
                    <a href="{{ url_for('products.checkout', product_id=product.id) }}" class="btn btn-primary action-btn">
                        {% if product.button_text %}
                            {{ product.button_text }}
                        {% elif product.is_free %}
                            <i class="fas fa-download me-1"></i> Get Free
                        {% else %}
                            <i class="fas fa-shopping-cart me-1"></i> Buy Now
                        {% endif %}
                    </a>
                    {% endif %}
                {% endif %}
                
                <a href="{{ url_for('products.index') }}" class="btn btn-outline-secondary action-btn">
                    <i class="fas fa-arrow-left me-1"></i> Back to Products
                </a>
            </div>
        </div>
    </div>
    
    {% if product.benefits %}
    <div class="benefits-section">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">Benefits</h2>
                <div class="row">
                    {% if product.benefits.startswith('[') %}
                        {% set benefits_list = product.benefits|from_json %}
                        {% for benefit in benefits_list %}
                        <div class="col-md-6">
                            <div class="benefit-item">
                                <div class="benefit-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    <strong>{{ benefit.title }}</strong>
                                    <p>{{ benefit.description }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        {% for benefit in product.benefits.split('\n') if benefit.strip() %}
                        <div class="col-md-6">
                            <div class="benefit-item">
                                <div class="benefit-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    {{ benefit.strip() }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if product.testimonials %}
    <div class="testimonials-section">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">What Our Customers Say</h2>
                <div class="row">
                    {% if product.testimonials.startswith('[') %}
                        {% set testimonials_list = product.testimonials|from_json %}
                        {% for testimonial in testimonials_list %}
                        <div class="col-md-6 mb-4">
                            <div class="testimonial-card">
                                <p>"{{ testimonial.text }}"</p>
                                <div class="mt-3">
                                    <strong>{{ testimonial.name }}</strong>
                                    {% if testimonial.role %}
                                    <br><small>{{ testimonial.role }}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        {% for testimonial in product.testimonials.split('---') if testimonial.strip() %}
                        <div class="col-md-6 mb-4">
                            <div class="testimonial-card">
                                <p>{{ testimonial.strip() }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if product.faq %}
    <div class="faq-section">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4">Frequently Asked Questions</h2>
                <div class="accordion" id="faqAccordion">
                    {% for faq_item in product.faq.split('Q:') if faq_item.strip() %}
                        {% set parts = faq_item.split('A:') %}
                        {% if parts|length > 1 %}
                            {% set question = parts[0].strip() %}
                            {% set answer = parts[1].strip() %}
                            <div class="faq-item">
                                <div class="faq-question">
                                    <strong>Q:</strong> {{ question }}
                                </div>
                                <div class="faq-answer">
                                    <strong>A:</strong> {{ answer }}
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    {% if product.slug %}
    <div class="row mt-5">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h4 class="card-title">Want more details?</h4>
                    <p class="card-text">Check out our detailed product page with all the features and benefits.</p>
                    <a href="{{ url_for('products.landing_page', slug=product.slug) }}" class="btn btn-outline-primary">
                        <i class="fas fa-info-circle me-1"></i> View Product Details
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}