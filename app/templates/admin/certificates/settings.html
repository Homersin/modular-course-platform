{% extends 'admin/layout.html' %}

{% block admin_title %}Certificate Settings{% endblock %}

{% block admin_content %}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-white">
        <h5 class="mb-0">Certificate Configuration</h5>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            {{ form.csrf_token }}
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Certificate Title</label>
                        {{ form.certificate_title(class="form-control") }}
                        <small class="text-muted">The title displayed on certificates (e.g., "Certificate of Completion")</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Certificate Border Color</label>
                        <div class="input-group">
                            {{ form.certificate_border_color(class="form-control form-control-color", type="color") }}
                            <span class="input-group-text">{{ form.certificate_border_color.data }}</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Certificate Text Color</label>
                        <div class="input-group">
                            {{ form.certificate_text_color(class="form-control form-control-color", type="color") }}
                            <span class="input-group-text">{{ form.certificate_text_color.data }}</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Certificate Font</label>
                        {{ form.certificate_font(class="form-select") }}
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="mb-3">
                        <label class="form-label">Certificate Logo</label>
                        {{ form.certificate_logo(class="form-control") }}
                        {% if settings.certificate_logo %}
                        <div class="mt-2">
                            <img src="{{ url_for('static', filename=settings.certificate_logo) }}" alt="Certificate Logo" style="max-width: 200px;" class="img-thumbnail">
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Certificate Signature</label>
                        {{ form.certificate_signature(class="form-control") }}
                        {% if settings.certificate_signature %}
                        <div class="mt-2">
                            <img src="{{ url_for('static', filename=settings.certificate_signature) }}" alt="Certificate Signature" style="max-width: 200px;" class="img-thumbnail">
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        {{ form.auto_issue_certificates(class="form-check-input") }}
                        <label class="form-check-label" for="autoIssueCertificates">Automatically issue certificates when courses are completed</label>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        {{ form.send_certificate_email(class="form-check-input") }}
                        <label class="form-check-label" for="sendCertificateEmail">Send email notification when certificates are issued</label>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Certificate Text Template</label>
                {{ form.certificate_text_template(class="form-control", rows="3") }}
                <small class="text-muted">Available variables: {user_name}, {course_title}, {issue_date}</small>
            </div>
            
            <hr>
            <h5 class="mb-3">Preview</h5>
            <div class="card mb-3">
                <div class="card-body text-center">
                    <img src="{{ url_for('admin.certificate_preview') }}" alt="Certificate Preview" class="img-fluid border shadow-sm" style="max-width: 100%;">
                </div>
            </div>
            
            <div class="text-end">
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Recently Issued Certificates</h5>
        <a href="{{ url_for('admin.certificates') }}" class="btn btn-sm btn-outline-primary">View All</a>
    </div>
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>User</th>
                    <th>Course</th>
                    <th>Issue Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for cert in recent_certificates %}
                <tr>
                    <td>{{ cert.user.name }}</td>
                    <td>{{ cert.course.title }}</td>
                    <td>{{ cert.issue_date.strftime('%Y-%m-%d') }}</td>
                    <td>
                        <div class="btn-group btn-group-sm">
                            <a href="{{ url_for('certificates.download', certificate_id=cert.certificate_id) }}" class="btn btn-outline-primary" target="_blank">
                                <i class="fas fa-download"></i>
                            </a>
                            <a href="{{ url_for('certificates.view', certificate_id=cert.certificate_id) }}" class="btn btn-outline-info" target="_blank">
                                <i class="fas fa-eye"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" class="text-center py-3">No certificates have been issued yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}